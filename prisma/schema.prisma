// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  // Ruta donde ya generaste el cliente
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum EstadoPedido {
  PENDIENTE
  PREPARACION
  LISTO
  ENTREGADO
  CANCELADO
}

model Rol {
  rolId        Int       @id @default(autoincrement())
  nombre       String    @unique
  descripcion  String?
  estado       Boolean   @default(true)
  fechaSistema DateTime  @default(now())

  usuarios     Usuario[]
}

model Usuario {
  usuarioId    Int       @id @default(autoincrement())
  nombre       String
  email        String    @unique
  password     String
  rolId        Int
  activo       Boolean   @default(true)
  fechaSistema DateTime  @default(now())

  rol          Rol       @relation(fields: [rolId], references: [rolId])
  pedidos      Pedido[]  // mesero/cajero que registra el pedido
}

model Categoria {
  categoriaId  Int       @id @default(autoincrement())
  nombre       String    @unique
  descripcion  String?
  activa       Boolean   @default(true)
  fechaSistema DateTime  @default(now())

  productos    Producto[]
}

model Producto {
  productoId   Int       @id @default(autoincrement())
  nombre       String
  descripcion  String?
  precio       Decimal   @db.Decimal(10, 2)
  activo       Boolean   @default(true)
  categoriaId  Int
  fechaSistema DateTime  @default(now())

  categoria    Categoria @relation(fields: [categoriaId], references: [categoriaId])
  detalles     PedidoDetalle[]
}

model Mesa {
  mesaId       Int       @id @default(autoincrement())
  numero       Int
  nombre       String?
  capacidad    Int?
  activa       Boolean   @default(true)
  fechaSistema DateTime  @default(now())

  pedidos      Pedido[]
  reservas     Reserva[]
}

model Cliente {
  clienteId     Int       @id @default(autoincrement())
  nombre        String
  telefono      String?
  correo        String?
  observaciones String?
  fechaSistema  DateTime  @default(now())

  pedidos       Pedido[]
  reservas      Reserva[]
}

model Pedido {
  pedidoId      Int           @id @default(autoincrement())
  mesaId        Int?
  clienteId     Int?
  usuarioId     Int
  estado        EstadoPedido  @default(PENDIENTE)
  total         Decimal       @db.Decimal(10, 2)
  fechaHora     DateTime      @default(now())
  observaciones String?

  mesa          Mesa?         @relation(fields: [mesaId], references: [mesaId])
  cliente       Cliente?      @relation(fields: [clienteId], references: [clienteId])
  usuario       Usuario       @relation(fields: [usuarioId], references: [usuarioId])
  detalles      PedidoDetalle[]
  pagos         Pago[]
}

model PedidoDetalle {
  pedidoDetalleId Int      @id @default(autoincrement())
  pedidoId        Int
  productoId      Int
  cantidad        Int      @default(1)
  precioUnitario  Decimal  @db.Decimal(10, 2)
  subtotal        Decimal  @db.Decimal(10, 2)

  pedido          Pedido   @relation(fields: [pedidoId], references: [pedidoId])
  producto        Producto @relation(fields: [productoId], references: [productoId])
}

model MetodoPago {
  metodoPagoId Int       @id @default(autoincrement())
  nombre       String    @unique
  descripcion  String?
  activo       Boolean   @default(true)
  fechaSistema DateTime  @default(now())

  pagos        Pago[]
}

model Pago {
  pagoId       Int       @id @default(autoincrement())
  pedidoId     Int
  metodoPagoId Int
  monto        Decimal   @db.Decimal(10, 2)
  fechaPago    DateTime  @default(now())
  referencia   String?

  pedido       Pedido     @relation(fields: [pedidoId], references: [pedidoId])
  metodoPago   MetodoPago @relation(fields: [metodoPagoId], references: [metodoPagoId])
}

model Reserva {
  reservaId        Int       @id @default(autoincrement())
  clienteId        Int
  mesaId           Int?
  fechaReserva     DateTime
  cantidadPersonas Int?
  observaciones    String?
  fechaSistema     DateTime  @default(now())

  cliente          Cliente   @relation(fields: [clienteId], references: [clienteId])
  mesa             Mesa?     @relation(fields: [mesaId], references: [mesaId])
}
